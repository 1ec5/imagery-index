<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'/>
<title>Imagery Index</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'/>
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.js'></script>
<script src='https://kit.fontawesome.com/c772610440.js' crossorigin='anonymous'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.css' rel='stylesheet'/>
<style>
  body {
    margin: 0;
    padding: 0;
    color: #ddd;
    background: #111;
    font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace;
    overscroll-behavior: none;
  }
  a {
    text-decoration: none;
  }
  a:visited, a {
    color: #67e; font-weight: bold;
  }
  a:hover {
    color: #56a;
  }

  .col-container { display: flex; flex-flow: row nowrap; }
  .row-container { display: flex; flex-flow: column nowrap; }
  .col-container > div, .row-container > div { flex: 1 1 auto; }

  #wrap {
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
  }
  #side {
    flex: 0 0 25%;
    background: #222;
    padding: 10px;
  }
  #title {
    flex: 0 0 50px;
    align-items: center;
  }
  #controls {
    flex: 0 0 50px;
    padding: 10px 20px;
    align-items: center;
  }
  #octocat {
    flex: 0 0 40px;
  }
  #octocat a:visited, #octocat a {
    color: #ddd;
  }
  #octocat a:hover {
    color: #fff;
  }

  #title h2 {
    margin: 5px 15px;
  }
  #title .icon {
    flex: 0 0 32px;
  }
  input[type=range] {
    vertical-align: middle;
  }

</style>
</head>

<body>
<div id='wrap' class='col-container'>
  <div id='side' class='row-container'>
    <div id='title' class='col-container'>
      <div class='icon'><i class='fas fa-satellite fa-2x'></i></div>
      <div><h2>imagery-index</h2></div>
    </div>
    <div id='sidebar'>
    </div>
  </div>

  <div id='viewer' class='row-container'>
    <div id='controls' class='col-container'>
      <div>
        <label>Opacity: </label>
        <input id='slider' type='range' min='0' max='100' step='0' value='70'/>
        <span id='slider-value'>70%</span>
      </div>
      <div id='octocat'>
        <a href="https://github.com/ideditor/imagery-index" target="_blank">
        <i class='fab fa-github fa-2x'></i>
        </a>
      </div>
    </div>
    <div id='map'></div>
  </div>
</div>

<script>
var slider = document.getElementById('slider');
var sliderValue = document.getElementById('slider-value');

mapboxgl.accessToken = 'pk.eyJ1IjoibWlrZWxtYXJvbiIsImEiOiJjaWZlY25lZGQ2cTJjc2trbmdiZDdjYjllIn0.Wx1n0X7aeCQyDTnK6_mrGw';
var map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/light-v10',
  center: [0,0],
  zoom: 1
});

// wait for map to load before adjusting it
map.on('load', function() {
  // var dataURL = 'https://cdn.jsdelivr.net/gh/osmlab/osm-community-index@master/dist/combined.min.geojson';
  // map.addSource('osm-community-index', { type: 'geojson', data: dataURL });
  // map.addLayer({
  //   'id': 'osm-community-index',
  //   'type': 'fill',
  //   'source': 'osm-community-index',
  //   'paint': { 'fill-color': 'hsla(243, 93%, 64%, 0.24)', 'fill-opacity': 1 }
  // });

  var tiles = ['https://a.coct.aerial.openstreetmap.org.za/layer/za_coct_aerial_2013/{z}/{x}/{y}.jpg'];

  map.addLayer({
    id: 'raster-layer',
    type: 'raster',
    source: {
      type: 'raster',
      tiles: tiles,
    },
    paint: {
      'raster-opacity': 0.7
    },
    minzoom: 0,
    maxzoom: 22
  });

  var lastVal;
  slider.addEventListener('input', function(e) {
    var currVal = parseInt(e.target.value, 10);
    if (currVal !== lastVal) {
      lastVal = currVal;
      map.setPaintProperty('raster-layer', 'raster-opacity', currVal / 100);
      sliderValue.textContent = e.target.value + '%';
    }
  });

});

</script>
</body>
</html>